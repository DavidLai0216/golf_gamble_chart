<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>â›³ å°ç£é«˜çƒåšå¼ˆæˆç¸¾å¡ - ç©©å®šä¿®å¾©ç‰ˆ</title>
    <style>
        :root { --primary: #2e7d32; --bg: #f0f4f7; --win: #d32f2f; --lose: #1976d2; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
        h2 { margin: 0 0 12px 0; color: var(--primary); font-size: 1.1rem; border-left: 4px solid var(--primary); padding-left: 10px; }
        
        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; background: #f9f9f9; padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 14px; }
        .player-inputs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 10px; }
        .player-inputs input { width: 100%; padding: 10px 5px; border: 1px solid #ccc; border-radius: 6px; text-align: center; font-size: 14px; font-weight: bold; box-sizing: border-box; }

        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th, td { border: 1px solid #eee; padding: 8px 4px; text-align: center; }
        th { background: var(--primary); color: white; font-size: 13px; }
        
        .input-group { display: flex; flex-direction: column; gap: 5px; align-items: center; }
        input[type="number"] { width: 42px; height: 32px; border: 1px solid #bbb; border-radius: 4px; text-align: center; font-size: 15px; -webkit-appearance: none; }
        .putt-in { background-color: #e8f5e9; border-color: #a5d6a7 !important; }
        
        .hdcp-btn { font-size: 11px; background: #eee; border: 1px solid #ccc; border-radius: 4px; padding: 3px 6px; cursor: pointer; width: 42px; }
        .hdcp-btn.active { background: #ff9800; color: white; border-color: #f57c00; }

        .summary-table th { background: #455a64; }
        .summary-table td { font-size: 15px; font-weight: bold; padding: 12px 5px; }
        .val-win { color: var(--win); }
        .val-lose { color: var(--lose); }
        .footer-info { font-size: 11px; color: #666; margin-top: 10px; line-height: 1.5; background: #fffde7; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="card">
    <h2>â›³ çƒè³½èˆ‡è¦å‰‡è¨­å®š</h2>
    <div class="player-inputs">
        <input type="text" id="name0" value="å¤§æœªä¾†" oninput="renderTableHead(); calculate();">
        <input type="text" id="name1" value="å°æ˜Ÿæ˜Ÿ" oninput="renderTableHead(); calculate();">
        <input type="text" id="name2" value="Teresa" oninput="renderTableHead(); calculate();">
        <input type="text" id="name3" value="ç§€ç§€" oninput="renderTableHead(); calculate();">
    </div>
    <div class="config-grid">
        <label><input type="checkbox" id="cfgVegas" checked onchange="calculate()"> æ‹‰æ–¯ç¶­åŠ æ–¯ [cite: 3]</label>
        <label><input type="checkbox" id="cfgFlip" checked onchange="calculate()"> æŠ“é³¥ç¿»ç‰Œ [cite: 5]</label>
        <label><input type="checkbox" id="cfgOly" checked onchange="calculate()"> å¥§æ—åŒ¹å…‹ [cite: 6]</label>
        <div style="grid-column: span 1">
            æ›éšŠï¼š<select id="cfgPair" onchange="calculate()" style="padding: 2px;">
                <option value="6">æ¯ 6 æ´</option>
                <option value="9">æ¯ 9 æ´</option>
                <option value="18">å›ºå®šæ­æª”</option>
            </select>
        </div>
    </div>
</div>

<div class="card" style="padding: 5px;">
    <div class="table-wrapper">
        <table>
            <thead><tr id="tableHead"><th>æ´</th><th>çƒå“¡A</th><th>çƒå“¡B</th><th>çƒå“¡C</th><th>çƒå“¡D</th></tr></thead>
            <tbody id="mainBody"></tbody>
        </table>
    </div>
</div>

<div class="card">
    <h2>ğŸ’° å³æ™‚çµç®—ç¸½è¦½</h2>
    <table class="summary-table">
        <thead><tr><th>çƒå“¡</th><th>æ‹‰æ–¯é»æ•¸</th><th>å¥§æ—åŒ¹å…‹</th><th>ç¸½è¨ˆ</th></tr></thead>
        <tbody id="summaryBody"></tbody>
    </table>
    <div class="footer-info">
        â€¢ <b>æ‹‰æ–¯è¦å‰‡</b>ï¼šå…©äººæ¡¿æ•¸ä¸²è¯ï¼ˆå°æ¡¿åä½ã€å¤§æ¡¿å€‹ä½ï¼‰ã€‚ [cite: 4, 20]<br>
        â€¢ <b>ç¿»ç‰Œ (Flip)</b>ï¼šå‹éšŠæœ‰ Birdie (â‰¤3æ¡¿) æ™‚ï¼Œæ•—éšŠåˆ†æ•¸æ•¸å­—å°èª¿ã€‚ <br>
        â€¢ <b>å¥§æ—åŒ¹å…‹</b>ï¼šä¸€æ¨é€²æ´æ‰è¨ˆåˆ†ï¼ˆé‡‘4ã€éŠ€3ã€éŠ…2ã€éµ1ï¼‰ã€‚ 
    </div>
</div>

<script>
    // 1. å‹•æ…‹ç”Ÿæˆ 18 æ´è¡¨æ ¼
    const mainBody = document.getElementById('mainBody');
    for (let h = 1; h <= 18; h++) {
        const tr = document.createElement('tr');
        let cols = `<td><b>${h}</b></td>`;
        for (let p = 0; p < 4; p++) {
            cols += `<td>
                <div class="input-group">
                    <input type="number" class="score-in" data-h="${h}" data-p="${p}" placeholder="æ¡¿" oninput="calculate()">
                    <input type="number" class="putt-in" data-h="${h}" data-p="${p}" placeholder="æ¨" oninput="calculate()">
                    <button class="hdcp-btn" data-h="${h}" data-p="${p}" onclick="this.classList.toggle('active'); calculate();">è®“</button>
                </div>
            </td>`;
        }
        tr.innerHTML = cols;
        mainBody.appendChild(tr);
    }

    // 2. æ›´æ–°è¡¨é ­å§“å
    function renderTableHead() {
        const headRow = document.getElementById('tableHead');
        let html = '<th>æ´</th>';
        for (let i = 0; i < 4; i++) {
            html += `<th>${document.getElementById('name' + i).value}</th>`;
        }
        headRow.innerHTML = html;
    }

    // 3. æ ¸å¿ƒè¨ˆç®—é‚è¼¯
    function calculate() {
        const useVegas = document.getElementById('cfgVegas').checked;
        const useFlip = document.getElementById('cfgFlip').checked;
        const useOly = document.getElementById('cfgOly').checked;
        const pairRule = parseInt(document.getElementById('cfgPair').value);
        
        let playerTotals = [0, 1, 2, 3].map(() => ({ vegas: 0, oly: 0 }));

        for (let h = 1; h <= 18; h++) {
            let holeScores = [], holePutts = [], holeValid = true;

            for (let p = 0; p < 4; p++) {
                let sVal = document.querySelector(`.score-in[data-h="${h}"][data-p="${p}"]`).value;
                let pVal = document.querySelector(`.putt-in[data-h="${h}"][data-p="${p}"]`).value;
                let hasHdcp = document.querySelector(`.hdcp-btn[data-h="${h}"][data-p="${p}"]`).classList.contains('active');

                if (sVal === "") { holeValid = false; break; }
                holeScores.push(parseInt(sVal) - (hasHdcp ? 1 : 0));
                holePutts.push(pVal !== "" ? parseInt(pVal) : 99);
            }

            if (!holeValid) continue; // å››å€‹äººéƒ½å¡«äº†æ¡¿æ•¸æ‰ç®—é€™æ´

            // A. æ‹‰æ–¯ç¶­åŠ æ–¯é‹ç®— [cite: 1, 3]
            if (useVegas) {
                let idx;
                if (h <= pairRule) idx = [0, 1, 2, 3]; // A+B vs C+D
                else if (h <= pairRule * 2) idx = [0, 2, 1, 3]; // A+C vs B+D
                else idx = [0, 3, 1, 2]; // A+D vs B+C

                let s = idx.map(i => holeScores[i]);
                let val1 = Math.min(s[0], s[1]) * 10 + Math.max(s[0], s[1]); [cite: 4]
                let val2 = Math.min(s[2], s[3]) * 10 + Math.max(s[2], s[3]); [cite: 4]

                if (useFlip) { [cite: 5]
                    if (val1 < val2 && (s[0] <= 3 || s[1] <= 3)) val2 = (val2 % 10) * 10 + Math.floor(val2 / 10); [cite: 30]
                    else if (val2 < val1 && (s[2] <= 3 || s[3] <= 3)) val1 = (val1 % 10) * 10 + Math.floor(val1 / 10); [cite: 30]
                }

                let diff = val2 - val1;
                playerTotals[idx[0]].vegas += diff; playerTotals[idx[1]].vegas += diff;
                playerTotals[idx[2]].vegas -= diff; playerTotals[idx[3]].vegas -= diff;
            }

            // B. å¥§æ—åŒ¹å…‹é‹ç®— (é‡‘éŠ€éŠ…éµ 4,3,2,1) [cite: 2, 31]
            if (useOly) {
                const points = [4, 3, 2, 1];
                holePutts.forEach((pt, i) => {
                    if (pt === 1) playerTotals[i].oly += points[i]; [cite: 6, 33]
                });
            }
        }

        // 4. æ¸²æŸ“çµæœè¡¨æ ¼
        const summaryBody = document.getElementById('summaryBody');
        summaryBody.innerHTML = [0, 1, 2, 3].map(i => {
            const name = document.getElementById('name' + i).value;
            const v = playerTotals[i].vegas;
            const o = playerTotals[i].oly;
            const total = v + o;
            return `<tr>
                <td>${name}</td>
                <td class="${v >= 0 ? 'val-win' : 'val-lose'}">${v}</td>
                <td style="color:#2e7d32">${o}</td>
                <td class="${total >= 0 ? 'val-win' : 'val-lose'}">${total}</td>
            </tr>`;
        }).join('');
    }

    // åˆå§‹åŸ·è¡Œä¸€æ¬¡
    renderTableHead();
    calculate();
</script>
</body>
</html>
